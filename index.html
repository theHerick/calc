<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Scanner BLE LocSound</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background: #f0f0f0;
    }

    button {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      background-color: #4CAF50;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    .device-btn {
      background-color: #2196F3;
    }

    .device-btn:hover {
      background-color: #1976D2;
    }

    #status {
      margin-top: 20px;
      font-size: 18px;
      color: #333;
    }

    #deviceContainer {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h2>Scanner BLE - LocSound</h2>
  <button id="scanBtn">üîç Scanear Dispositivo</button>
  <div id="status">Clique em "Scanear Dispositivo" para come√ßar.</div>

  <div id="deviceContainer"></div>

  <script>
    const scanBtn = document.getElementById('scanBtn');
    const status = document.getElementById('status');
    const deviceContainer = document.getElementById('deviceContainer');

    const dispositivos = new Map(); // Mapa de nome => device

    scanBtn.addEventListener('click', async () => {
      if (!navigator.bluetooth) {
        status.textContent = "‚ùå Seu navegador n√£o suporta Web Bluetooth.";
        return;
      }

      try {
        const device = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: "LocSound" }],
          optionalServices: ['battery_service'] // Ajuste conforme necess√°rio
        });

        if (!device.name) {
          status.textContent = "‚ö†Ô∏è Dispositivo sem nome ignorado.";
          return;
        }

        // Evita duplicar bot√µes
        if (!dispositivos.has(device.name)) {
          dispositivos.set(device.name, device);
          criarBotaoDispositivo(device.name);
          status.textContent = `üì° Dispositivo adicionado: ${device.name}`;
        } else {
          status.textContent = `‚ÑπÔ∏è Dispositivo ${device.name} j√° est√° listado.`;
        }

      } catch (error) {
        status.textContent = "‚ùå Erro: " + error.message;
      }
    });

    function criarBotaoDispositivo(nome) {
      const btn = document.createElement('button');
      btn.className = 'device-btn';
      btn.textContent = `Conectar - ${nome}`;
      btn.addEventListener('click', async () => {
        const device = dispositivos.get(nome);
        if (!device) return;

        try {
          status.textContent = `üîå Conectando a ${nome}...`;
          const server = await device.gatt.connect();
          status.textContent = `‚úÖ Conectado a ${nome}`;

          // Aqui voc√™ pode acessar servi√ßos/caracter√≠sticas se quiser:
          // const service = await server.getPrimaryService('battery_service');

        } catch (error) {
          status.textContent = `‚ùå Erro ao conectar a ${nome}: ${error.message}`;
        }
      });

      deviceContainer.appendChild(btn);
    }
  </script>

</body>
</html>
