<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora Solar para Carro El√©trico</title>
<style>
  :root{
    --bg: #0b1020;
    --card: rgba(255,255,255,0.06);
    --glass: rgba(255,255,255,0.08);
    --text: #ecf0ff;
    --muted: #c7cbee;
    --accent: #7ccfff;
    --accent-2: #a18cff;
    --ok: #7dffa7;
    --warn: #ffd37d;
    --err: #ff8f8f;
    --shadow: 0 10px 30px rgba(0,0,0,0.45);
    --radius: 16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji";
    color:var(--text);
    background:
      radial-gradient(1200px 800px at 20% -10%, #2a3baa 0%, transparent 60%),
      radial-gradient(1000px 700px at 120% 10%, #26a3c8 0%, transparent 55%),
      radial-gradient(900px 600px at 50% 120%, #8e46ff 0%, transparent 45%),
      var(--bg);
    background-attachment: fixed;
  }
  header{
    padding: 28px 20px 8px;
    text-align:center;
  }
  h1{
    margin:0;
    font-size: clamp(28px, 4vw, 40px);
    letter-spacing: .4px;
  }
  .subtitle{
    margin-top:8px;
    color:var(--muted);
    font-size: clamp(14px, 2.2vw, 16px);
  }

  .container{
    width:min(1100px, 92vw);
    margin: 28px auto 80px;
    display:grid;
    grid-template-columns: 1.1fr 1fr;
    gap: 18px;
  }
  @media (max-width: 980px){
    .container{grid-template-columns:1fr}
  }

  .panel, .results{
    background: linear-gradient(180deg, var(--glass), transparent 140%);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 18px;
  }

  .section-title{
    font-size: 16px;
    letter-spacing: .3px;
    margin: 8px 4px 12px;
    color: var(--accent);
    display:flex;
    align-items:center;
    gap:8px;
  }

  .grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  @media (max-width:680px){ .grid{grid-template-columns:1fr} }

  .cards-dyn {
    display: flex;
    flex-direction: column;
    gap: 18px;
    margin-bottom: 8px;
  }
  .card-dyn {
    background: var(--card);
    border: 1.5px solid rgba(255,255,255,0.14);
    border-radius: 14px;
    box-shadow: 0 4px 18px rgba(0,0,0,0.18);
    padding: 18px 16px 10px 16px;
    position: relative;
    transition: box-shadow .2s;
  }
  .card-dyn:hover {
    box-shadow: 0 8px 32px rgba(124,207,255,0.12);
    border-color: var(--accent);
  }
  .card-dyn .card-title {
    font-size: 15px;
    color: var(--accent);
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: .2px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .card-dyn .remove-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: transparent;
    color: var(--err);
    border: none;
    font-size: 15px;
    cursor: pointer;
    font-weight: bold;
    padding: 2px 8px;
    border-radius: 8px;
    transition: background .2s;
  }
  .card-dyn .remove-btn:hover {
    background: rgba(255,143,143,0.12);
  }

  label{
    font-size: 13px;
    color: var(--muted);
    display:flex;
    align-items:center;
    justify-content: space-between;
    margin-bottom:6px;
    gap:10px;
  }
  .hint{
    font-size: 12px;
    color: var(--muted);
    opacity:.85;
  }
  .field{
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.16);
    border-radius: 12px;
    padding: 12px 12px;
    color: var(--text);
    width: 100%;
    outline:none;
  }
  .field:focus{
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(124,207,255,0.15);
  }
  .unit{
    opacity:.8; font-size:12px;
  }

  .actions{
    display:flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 12px;
  }
  button{
    appearance: none;
    border: none;
    border-radius: 12px;
    padding: 12px 16px;
    cursor:pointer;
    color:#0b1020;
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    font-weight: 700;
    letter-spacing: .2px;
    box-shadow: var(--shadow);
  }
  button.secondary{
    background: transparent;
    color: var(--text);
    border:1px solid rgba(255,255,255,0.2);
  }

  .results{
    display:flex;
    flex-direction:column;
    gap: 12px;
  }
  .cards{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }
  @media (max-width:680px){ .cards{grid-template-columns:1fr} }
  .card{
    background: var(--card);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 14px;
    padding: 16px;
    min-height: 106px;
  }
  .kpi{
    font-size: clamp(22px, 3.6vw, 30px);
    font-weight: 800;
    line-height: 1.15;
  }
  .kpi small{font-weight:600; font-size: 12px; opacity:.85}
  .kpi-label{
    color: var(--muted);
    margin-top: 6px;
    font-size: 13px;
  }
  .note{
    font-size: 12px; color: var(--muted);
  }
  .ok{ color: var(--ok); }
  .warn{ color: var(--warn); }
  .err{ color: var(--err); }

  details{
    background: rgba(255,255,255,0.05);
    border: 1px dashed rgba(255,255,255,0.2);
    padding: 10px 12px;
    border-radius: 12px;
  }
  summary{
    cursor:pointer;
    color:var(--muted);
    font-weight:600;
    margin: -4px 0 6px;
  }

  footer{
    text-align:center;
    padding: 32px 12px 40px;
    color: var(--muted);
    font-weight:600;
  }
  .brand{
    display:inline-block;
    padding: 8px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.18);
  }
</style>
</head>
<body>
  <header>
    <h1>Calculadora Solar &nbsp;‚Üí&nbsp; Carro El√©trico</h1>
    <div class="subtitle">Descubra quanta energia seu sistema fotovoltaico precisa gerar e o tempo para carregar seu EV.</div>
  </header>

  <div class="container">
    <!-- Entrada -->
    <div class="panel">
  <div class="section-title">‚ö° Especifica√ß√µes do Carro</div>
  <div id="carrosContainer"></div>
  <div style="display:flex; gap:8px; margin:6px 2px 14px; flex-wrap:wrap;">
    <button type="button" class="secondary" style="padding:8px 14px;font-size:12px;" onclick="adicionarCarro()">+ Adicionar Carro</button>
  </div>
  <div class="section-title" style="margin-top:16px;">‚òÄÔ∏è Sistema Fotovoltaico</div>
  <div id="placasContainer"></div>
  <div style="display:flex; gap:8px; margin:6px 2px 14px; flex-wrap:wrap;">
    <button type="button" class="secondary" style="padding:8px 14px;font-size:12px;" onclick="adicionarPlaca()">+ Adicionar Placa</button>
  </div>
      <div class="actions">
        <button id="calcBtn">Calcular</button>
        <button class="secondary" id="resetBtn">Limpar</button>
      </div>
      <!-- Bot√£o √∫nico para abrir modal de salvar/modelos -->
      <div style="margin-top:18px; display:flex; justify-content:flex-end;">
        <button id="openSaveModalBtn" type="button" style="min-width:140px;">üíæ Salvar / Modelos</button>
      </div>
      <details style="margin-top:12px">
        <summary>Como calculamos?</summary>
        <div class="hint">
          <p><b>Energia na bateria</b>: E_bat = Cap_utiliz√°vel_kWh √ó (SOC_final ‚àí SOC_inicial)</p>
          <p><b>Energia FV necess√°ria</b>: E_PV = E_bat / Œ∑_global</p>
          <p><b>Gera√ß√£o di√°ria</b>: E_dia = kWp √ó PSH √ó PR</p>
          <p><b>Dias necess√°rios</b>: Dias = E_PV / E_dia</p>
          <p><b>Horas de sol pleno</b>: Horas = E_PV / (kWp √ó PR)</p>
          <p><b>Limite te√≥rico por pot√™ncia</b>: t_m√≠n ‚âà E_bat / min(onboard_kW, kWp √ó PR)</p>
        </div>
      </details>
    </div>
    <!-- Resultados -->
    <div class="results">
      <div class="section-title">üìä Resultados</div>
      <div class="cards">
        <div class="card">
          <div class="kpi" id="kpiEbat">‚Äî</div>
          <div class="kpi-label">Energia para a bateria</div>
          <div class="note">Entre SOC inicial e final.</div>
        </div>
        <div class="card">
          <div class="kpi" id="kpiEpv">‚Äî</div>
          <div class="kpi-label">Energia FV necess√°ria (rede ‚Üí bateria)</div>
          <div class="note">Considerando a efici√™ncia global.</div>
        </div>
        <div class="card">
          <div class="kpi" id="kpiEdia">‚Äî</div>
          <div class="kpi-label">Gera√ß√£o di√°ria estimada</div>
          <div class="note">kWp √ó PSH √ó PR.</div>
        </div>
        <div class="card">
          <div class="kpi" id="kpiDias">‚Äî</div>
          <div class="kpi-label">Dias necess√°rios</div>
          <div class="note">M√©dia ‚Äî varia com clima/esta√ß√£o.</div>
        </div>
        <div class="card">
          <div class="kpi" id="kpiHoras">‚Äî</div>
          <div class="kpi-label">Horas de sol pleno equivalentes</div>
          <div class="note">Total acumulado necess√°rio.</div>
        </div>
        <div class="card">
          <div class="kpi" id="kpiTmin">‚Äî</div>
          <div class="kpi-label">Tempo m√≠nimo te√≥rico</div>
          <div class="note">Limitado por pot√™ncia (irrealista/idealizado).</div>
        </div>
      </div>
      <div id="alerts" style="margin-top:8px; display:none;">
        <div class="note" id="alertText"></div>
      </div>
      <details style="margin-top:4px">
        <summary>Notas & Limita√ß√µes</summary>
        <div class="hint">
          <ul>
            <li>Valores de PR e PSH s√£o m√©dias; clima e esta√ß√£o alteram bastante.</li>
            <li>Perto de 80‚Äì100% de SOC, o BMS reduz a pot√™ncia de carga.</li>
            <li>O tempo m√≠nimo te√≥rico assume pot√™ncia constante e condi√ß√µes ideais.</li>
            <li>Se o sistema for off-grid/DC direto, ajuste a efici√™ncia global conforme o caso.</li>
          </ul>
        </div>
      </details>
    </div>
  </div>

  <footer>
    <span class="brand">IoTEC Lab - UNIVALI</span>
  </footer>
  <footer>
        Desenvolvido por Tiburski, Herick Betin ‚Ä¢ 2025
  </footer>
  
  <!-- Modal global (fora do panel para evitar stacking context) -->
  <div id="saveModal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
      <button type="button" id="closeSaveModalBtn" class="modal-close" title="Fechar">√ó</button>
      <h3 class="modal-title">Salvar / Modelos</h3>
      <div class="modal-content">
        <div class="modal-block">
          <div class="modal-block-head">
            <span class="modal-block-title">Configura√ß√µes</span>
            <span class="count-badge" id="countConfigs">0</span>
          </div>
          <p class="mini-hint">Salve conjuntos completos (carros + placas) para reutilizar depois.</p>
          <div class="modal-row">
            <input id="configNameInput" class="field" placeholder="Nome da configura√ß√£o">
            <button id="saveConfigModalBtn" type="button">Salvar</button>
          </div>
          <div class="modal-row">
            <select id="savedConfigs" class="flex"></select>
            <button id="loadConfigBtn" type="button">Carregar</button>
            <button id="deleteConfigBtn" type="button">Excluir</button>
          </div>
        </div>
        <div class="modal-block">
          <div class="modal-block-head">
            <span class="modal-block-title">Modelos de Carro</span>
            <span class="count-badge" id="countCarModels">0</span>
          </div>
          <p class="mini-hint">Salve especifica√ß√µes t√≠picas (bateria, efici√™ncia, limites) de cada ve√≠culo.</p>
          <div class="modal-row">
            <input id="carModelNameInput" class="field" placeholder="Nome do modelo">
            <select id="carSelect" title="Carro alvo"></select>
            <button id="saveCarModelBtn" type="button">Salvar</button>
          </div>
          <div class="modal-row">
            <select id="savedCarModels" class="flex"></select>
            <select id="carSelectApply" title="Aplicar em"></select>
            <button id="loadCarModelBtn" type="button">Aplicar</button>
          </div>
        </div>
        <div class="modal-block">
          <div class="modal-block-head">
            <span class="modal-block-title">Modelos de Placa</span>
            <span class="count-badge" id="countPlacaModels">0</span>
          </div>
          <p class="mini-hint">Guarde combina√ß√µes de pot√™ncia, PR e PSH para cen√°rios diferentes.</p>
          <div class="modal-row">
            <input id="placaModelNameInput" class="field" placeholder="Nome do modelo">
            <select id="placaSelect" title="Placa alvo"></select>
            <button id="savePlacaModelBtn" type="button">Salvar</button>
          </div>
            <div class="modal-row">
            <select id="savedPlacaModels" class="flex"></select>
            <select id="placaSelectApply" title="Aplicar em"></select>
            <button id="loadPlacaModelBtn" type="button">Aplicar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// Estilos extras do modal injetados via JS/CSS inline para manter tudo em um arquivo
(function(){
  const style = document.createElement('style');
  style.textContent = `
  .modal-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(5,10,25,0.72);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);z-index:100000;}
  .modal-box{width:min(780px,92vw);max-height:80vh;overflow:auto;background:linear-gradient(180deg,var(--glass),rgba(255,255,255,0.04));border:1px solid rgba(255,255,255,0.22);border-radius:20px;box-shadow:0 18px 60px -8px rgba(0,0,0,0.55);padding:30px 26px 34px;position:relative;}
  .modal-title{margin:0 0 18px;font-size:22px;letter-spacing:.5px;color:var(--accent);}
  .modal-close{position:absolute;top:10px;right:12px;background:transparent;border:none;color:var(--err);font-size:26px;cursor:pointer;line-height:1;padding:2px 8px;border-radius:10px;}
  .modal-close:hover{background:rgba(255,143,143,0.15);} 
  .modal-content{display:flex;flex-direction:column;gap:26px;}
  .modal-block{background:rgba(255,255,255,0.04);padding:14px 16px 18px;border:1px solid rgba(255,255,255,0.12);border-radius:16px;position:relative;}
  .modal-block:before{content:"";position:absolute;inset:0;border-radius:16px;padding:1px;background:linear-gradient(140deg,rgba(124,207,255,0.35),rgba(161,140,255,0.25) 35%,rgba(255,255,255,0.05) 70%);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;opacity:.55;}
  .modal-block-title{font-weight:600;color:var(--accent);display:block;}
  .modal-block-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;gap:12px;}
  .mini-hint{margin:4px 0 10px;font-size:11px;letter-spacing:.3px;color:var(--muted);opacity:.85;}
  .count-badge{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#0b1020;font-size:11px;font-weight:700;padding:4px 10px;border-radius:999px;box-shadow:0 2px 6px rgba(0,0,0,0.35);}
  .modal-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
  .modal-row .field, .modal-row select{flex:1;min-width:160px;}
  .modal-row select{background:var(--card);border:1px solid rgba(255,255,255,0.18);color:var(--text);padding:12px 12px;border-radius:12px;outline:none;appearance:none;position:relative;}
  .modal-row select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(124,207,255,0.15);} 
  .modal-row button{min-width:90px;}
  body.modal-open{overflow:hidden;}
  @media (max-width:640px){ .modal-box{padding:24px 18px;} .modal-row{flex-direction:column;align-items:stretch;} .modal-row .field, .modal-row select, .modal-row button{width:100%;} }
  `;
  document.head.appendChild(style);
})();

// Utilit√°rios
function num(v, def=0){
  const n = Number(v);
  return Number.isFinite(n) ? n : def;
}
function clamp(n, a, b){
  return Math.min(Math.max(n, a), b);
}
function fmtKWh(x){
  if (!Number.isFinite(x)) return '‚Äî';
  return x >= 100 ? x.toFixed(0) + ' kWh' : x.toFixed(2) + ' kWh';
}
function fmtKW(x){
  if (!Number.isFinite(x)) return '‚Äî';
  return x.toFixed(2) + ' kW';
}
function fmtH(x){
  if (!Number.isFinite(x)) return '‚Äî';
  return x.toFixed(1) + ' h';
}
function fmtDias(x){
  if (!Number.isFinite(x)) return '‚Äî';
  if (x < 1) return (x*24).toFixed(1) + ' h';
  return x.toFixed(2) + ' dias';
}

// L√≥gica do modal (abrir/fechar) integrada corretamente
function initSaveModal(){
  const openBtn = document.getElementById('openSaveModalBtn');
  const modal = document.getElementById('saveModal');
  const closeBtn = document.getElementById('closeSaveModalBtn');
  if(!openBtn || !modal || !closeBtn) return;
  const open = ()=>{ 
    modal.style.display='flex'; 
    document.body.classList.add('modal-open'); 
    // foco priorit√°rio
    setTimeout(()=>{
      const cfg = document.getElementById('configNameInput');
      if(cfg) cfg.focus();
      autoFillModelName('car');
      autoFillModelName('placa');
    },60);
  };
  const close = ()=>{ modal.style.display='none'; document.body.classList.remove('modal-open'); };
  openBtn.addEventListener('click', open);
  closeBtn.addEventListener('click', close);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
}

// Preenche automaticamente campo de nome de modelo se vazio
function autoFillModelName(tipo){
  if(tipo==='car'){
    const input = document.getElementById('carModelNameInput');
    if(input && !input.value){
      const sel = document.getElementById('carSelect');
      if(sel){
        const id = sel.value;
        const nomeCar = document.getElementById('carroNome'+id)?.value?.trim();
        if(nomeCar) input.value = nomeCar;
      }
    }
  }else if(tipo==='placa'){
    const input = document.getElementById('placaModelNameInput');
    if(input && !input.value){
      const sel = document.getElementById('placaSelect');
      if(sel){
        const id = sel.value;
        const nomePlaca = document.getElementById('placaNome'+id)?.value?.trim();
        if(nomePlaca) input.value = nomePlaca;
      }
    }
  }
}

// Listeners para mudan√ßa de sele√ß√£o atualizar sugest√£o de nome
document.addEventListener('change', (e)=>{
  if(e.target && e.target.id==='carSelect') autoFillModelName('car');
  if(e.target && e.target.id==='placaSelect') autoFillModelName('placa');
});

// Enter envia salvamento no campo de nome correspondente
document.addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){
    if(document.activeElement===document.getElementById('configNameInput')){
      saveConfig();
    }else if(document.activeElement===document.getElementById('carModelNameInput')){
      saveCarModel();
    }else if(document.activeElement===document.getElementById('placaModelNameInput')){
      savePlacaModel();
    }
  }
});

// Carros din√¢micos
function carroFields(id, values={}){
  return `<div class="card-dyn">
    <div class="card-title">üöó ${values.nome||'' ? values.nome : 'Carro '+(id+1)}</div>
    <button type="button" class="remove-btn" onclick="removerCarro(${id})" title="Remover">√ó</button>
    <div class="grid">
      <div><label>Nome do carro</label><input class="field" id="carroNome${id}" type="text" value="${values.nome||''}" placeholder="Ex: EV1"></div>
      <div><label>Capacidade da bateria <span class="unit">kWh</span></label><input class="field" id="capNominal${id}" type="number" min="1" step="0.1" value="${values.capNominal||60}"></div>
      <div>
        <label>Capacidade utiliz√°vel <span class="unit">%</span>
          <span style="cursor:pointer;color:var(--accent);font-size:16px;margin-left:6px;" onclick="toggleUtilHelper(${id})" title="Calcular a % a partir de kWh">&#x3f;</span>
        </label>
        <input class="field" id="percUtil${id}" type="number" min="50" max="100" step="1" value="${values.percUtil||95}">
        <div id="utilHelper${id}" style="display:none;margin-top:8px;background:rgba(124,207,255,0.08);padding:10px 12px;border-radius:10px;">
          <div style="font-size:12px;line-height:1.3;margin-bottom:6px;color:var(--muted);">
            <b>% Utiliz√°vel = Cap_utiliz√°vel / Cap_nominal √ó 100</b><br>
            Insira valores em kWh. Usaremos Capacidade da bateria acima se deixar em branco.
          </div>
          <label style="font-size:12px;">Capacidade nominal (kWh)</label>
          <input class="field" id="capNominalCalc${id}" type="number" min="0" step="0.01" style="margin-bottom:6px;" placeholder="auto se vazio">
          <label style="font-size:12px;">Capacidade utiliz√°vel (kWh)</label>
            <input class="field" id="capUtilCalc${id}" type="number" min="0" step="0.01" style="margin-bottom:6px;" placeholder="Ex: 75">
          <button type="button" class="secondary" onclick="calcularPercUtil(${id})">Calcular %</button>
          <div id="percUtilResult${id}" style="margin-top:6px;font-size:13px;color:var(--accent);"></div>
        </div>
      </div>
      <div><label>SOC inicial <span class="unit">%</span></label><input class="field" id="socIni${id}" type="number" min="0" max="100" step="1" value="${values.socIni||20}"></div>
      <div><label>SOC final <span class="unit">%</span></label><input class="field" id="socFim${id}" type="number" min="1" max="100" step="1" value="${values.socFim||100}"></div>
      <div>
        <label>Efici√™ncia global FV‚Üíbateria <span class="unit">%</span>
          <span style="cursor:pointer;color:var(--accent);font-size:16px;margin-left:6px;" onclick="toggleEtaHelper(${id})" title="Calcular / entender efici√™ncia">&#x3f;</span>
        </label>
        <input class="field" id="etaGlobal${id}" type="number" min="60" max="99" step="1" value="${values.etaGlobal||85}">
        <div id="etaHelper${id}" style="display:none;margin-top:8px;background:rgba(124,207,255,0.08);padding:10px 12px;border-radius:10px;">
          <div style="font-size:12px;line-height:1.3;margin-bottom:6px;color:var(--muted);">
            <b>Efici√™ncia (%) = E_armazenada / E_saida_inversor √ó 100</b><br>
            Onde E_armazenada √© a energia efetiva que entrou na bateria (ŒîSOC √ó Cap_utiliz√°vel) e E_saida_inversor √© a energia AC (ou DC antes do conversor) entregue ao carregador.<br>
            Use medi√ß√µes reais ou estime. Para simula√ß√£o sem dados: <b>80‚Äì88%</b> (sistemas AC residenciais), <b>88‚Äì92%</b> (otimizado / menos convers√µes). Abaixo de 75% investigue perdas.
          </div>
          <label style="font-size:12px;">Energia armazenada (kWh) E_armazenada</label>
          <input class="field" id="Earma${id}" type="number" min="0" step="0.01" style="margin-bottom:6px;" placeholder="Ex: 30">
          <label style="font-size:12px;">Energia sa√≠da inversor (kWh) E_saida</label>
          <input class="field" id="Esaida${id}" type="number" min="0" step="0.01" style="margin-bottom:6px;" placeholder="Ex: 36">
          <button type="button" class="secondary" onclick="calcularEta(${id})">Calcular Œ∑</button>
          <div id="etaResult${id}" style="margin-top:6px;font-size:13px;color:var(--accent);"></div>
          <details style="margin-top:6px;">
            <summary style="font-size:11px;">Faixas / Notas</summary>
            <div style="font-size:11px;color:var(--muted);line-height:1.35;">
              <b>‚â• 90%</b>: excelente (m√≠nimas perdas).<br>
              <b>80‚Äì89%</b>: t√≠pico / bom.<br>
              <b>75‚Äì79%</b>: aceit√°vel, revisar ajustes (cabos, temperaturas).<br>
              <b><75%</b>: investigar: convers√µes m√∫ltiplas, aquecimento, cabos subdimensionados, BMS limitando.<br>
              Valor estimado n√£o substitui medi√ß√£o real.
            </div>
          </details>
        </div>
      </div>
      <div><label>Pot√™ncia m√°x. do carregador onboard <span class="unit">kW</span></label><input class="field" id="onboardKW${id}" type="number" min="0" step="0.1" value="${values.onboardKW||7.4}"></div>
    </div>
  </div>`;
}
function placaFields(id, values={}){
  return `<div class="card-dyn">
    <div class="card-title">‚òÄÔ∏è ${values.nome||'' ? values.nome : 'Placa '+(id+1)}</div>
    <button type="button" class="remove-btn" onclick="removerPlaca(${id})" title="Remover">√ó</button>
    <div class="grid">
      <div><label>Nome da placa</label><input class="field" id="placaNome${id}" type="text" value="${values.nome||''}" placeholder="Ex: FV1"></div>
      <div>
        <label>Pot√™ncia do array <span class="unit">kWp</span>
          <span style="cursor:pointer;color:var(--accent);font-size:16px;margin-left:6px;" onclick="toggleParrayHelper(${id})" title="Calcular pot√™ncia do array">&#x3f;</span>
        </label>
        <input class="field" id="kWp${id}" type="number" min="0.1" step="0.1" value="${values.kWp||2.0}">
        <div id="parrayHelper${id}" style="display:none;margin-top:8px;background:rgba(124,207,255,0.08);padding:10px;border-radius:10px;">
          <label style="font-size:13px;">Pot√™ncia do m√≥dulo (W)</label>
          <input class="field" id="moduloPot${id}" type="number" min="1" step="1" style="margin-bottom:6px;">
          <label style="font-size:13px;">N¬∫ de m√≥dulos</label>
          <input class="field" id="numModulos${id}" type="number" min="1" step="1" style="margin-bottom:6px;">
          <button type="button" class="secondary" onclick="calcularParray(${id})">Calcular</button>
          <div id="parrayResult${id}" style="margin-top:6px;font-size:13px;color:var(--accent);"></div>
        </div>
      </div>
      <div>
        <label>Performance Ratio (PR) <span class="unit">%</span>
          <span style="cursor:pointer;color:var(--accent);font-size:16px;margin-left:6px;" onclick="togglePRHelper(${id})" title="Calcular / entender PR">&#x3f;</span>
        </label>
        <input class="field" id="pr${id}" type="number" min="50" max="95" step="1" value="${values.pr||75}">
        <div id="prHelper${id}" style="display:none;margin-top:8px;background:rgba(161,140,255,0.10);padding:10px 12px;border-radius:10px;">
          <div style="font-size:12px;line-height:1.3;margin-bottom:6px;color:var(--muted);">
            <b>PR = E_real / (P_instalada √ó H_ref) √ó 100</b><br>
            Faixa t√≠pica boa: 75‚Äì85%. Estimativa antes da instala√ß√£o: use 75‚Äì80% se n√£o tiver dados.<br>
            Para simula√ß√£o padr√£o: assuma perdas t√©rmicas, el√©tricas e sombreamento moderado.
          </div>
          <label style="font-size:12px;">Energia gerada (E_real) kWh</label>
          <input class="field" id="Ereal${id}" type="number" min="0" step="0.1" style="margin-bottom:6px;">
          <label style="font-size:12px;">Pot√™ncia instalada (P_instalada) kWp</label>
          <input class="field" id="Pinst${id}" type="number" min="0" step="0.01" style="margin-bottom:6px;" placeholder="auto usa kWp acima">
          <label style="font-size:12px;">Irradia√ß√£o ref. (H_ref) kWh/m¬≤</label>
          <input class="field" id="Href${id}" type="number" min="0" step="0.01" style="margin-bottom:6px;" placeholder="Ex: 5.0">
          <button type="button" class="secondary" onclick="calcularPR(${id})">Calcular PR</button>
          <div id="prResult${id}" style="margin-top:6px;font-size:13px;color:var(--accent);"></div>
          <details style="margin-top:6px;">
            <summary style="font-size:11px;">Resumo / Interpreta√ß√£o</summary>
            <div style="font-size:11px;color:var(--muted);line-height:1.35;">
              <b>Acima 85%</b>: excelente (perdas m√≠nimas).<br>
              <b>75‚Äì85%</b>: bom / esperado.<br>
              <b>70‚Äì75%</b>: aceit√°vel, verificar otimiza√ß√µes.<br>
              <b><70%</b>: investigar (sombreamento, sujeira, falhas, mismatch).<br>
              Sem medir E_real e H_ref voc√™ s√≥ tem estimativa, n√£o valor real.
            </div>
          </details>
        </div>
      </div>
      <div><label>Horas de Sol Pleno (PSH) <span class="unit">h/dia</span></label><input class="field" id="psh${id}" type="number" min="1" step="0.1" value="${values.psh||5}"></div>
      <div><label>Observa√ß√£o</label><input class="field" id="obs${id}" type="text" value="${values.obs||''}" placeholder="Orienta√ß√£o, inclina√ß√£o, sombreamento... (opcional)"></div>
    </div>
  </div>`;
}
// Helper para pot√™ncia do array
function toggleParrayHelper(id){
  const el = document.getElementById('parrayHelper'+id);
  if(el) el.style.display = (el.style.display==='none'||!el.style.display)?'block':'none';
}

// Helper PR
function togglePRHelper(id){
  const el = document.getElementById('prHelper'+id);
  if(el) el.style.display = (el.style.display==='none'||!el.style.display)?'block':'none';
}

function calcularPR(id){
  const Ereal = num(document.getElementById('Ereal'+id)?.value, 0);
  let Pinst = num(document.getElementById('Pinst'+id)?.value, 0);
  const Href = num(document.getElementById('Href'+id)?.value, 0);
  // usa kWp do campo principal se n√£o preencher Pinst
  if(Pinst<=0){
    Pinst = num(document.getElementById('kWp'+id)?.value, 0);
  }
  if(Ereal>0 && Pinst>0 && Href>0){
    const PR = (Ereal / (Pinst * Href)) * 100;
    document.getElementById('pr'+id).value = PR.toFixed(0);
    let classe = 'ok';
    if(PR < 70) classe='err'; else if(PR < 75) classe='warn'; else if(PR>85) classe='ok';
    document.getElementById('prResult'+id).innerHTML = `PR calculado: <b class="${classe}">${PR.toFixed(1)}%</b>`;
  } else {
    document.getElementById('prResult'+id).textContent = '';
  }
}

// Helper Efici√™ncia (Œ∑)
function toggleEtaHelper(id){
  const el = document.getElementById('etaHelper'+id);
  if(el) el.style.display = (el.style.display==='none'||!el.style.display)?'block':'none';
}

function calcularEta(id){
  const Earma = num(document.getElementById('Earma'+id)?.value, 0);
  const Esaida = num(document.getElementById('Esaida'+id)?.value, 0);
  if(Earma>0 && Esaida>0){
    const eta = (Earma / Esaida) * 100;
    document.getElementById('etaGlobal'+id).value = Math.min(99, Math.max(1, eta)).toFixed(0);
    let classe='ok';
    if(eta < 75) classe='err'; else if(eta < 80) classe='warn';
    document.getElementById('etaResult'+id).innerHTML = `Efici√™ncia calculada: <b class="${classe}">${eta.toFixed(1)}%</b>`;
  } else {
    document.getElementById('etaResult'+id).textContent='';
  }
}

// Helper % Capacidade Utiliz√°vel
function toggleUtilHelper(id){
  const el = document.getElementById('utilHelper'+id);
  if(el) el.style.display = (el.style.display==='none'||!el.style.display)?'block':'none';
}
function calcularPercUtil(id){
  let capNom = num(document.getElementById('capNominalCalc'+id)?.value, 0);
  const capNomField = num(document.getElementById('capNominal'+id)?.value, 0);
  if(capNom<=0) capNom = capNomField; // fallback
  const capUtil = num(document.getElementById('capUtilCalc'+id)?.value, 0);
  if(capNom>0 && capUtil>0){
    const perc = (capUtil / capNom) * 100;
    document.getElementById('percUtil'+id).value = Math.min(100, Math.max(0, perc)).toFixed(0);
    let classe='ok';
    if(perc < 85) classe='warn';
    if(perc < 75) classe='err';
    document.getElementById('percUtilResult'+id).innerHTML = `Utiliz√°vel: <b class="${classe}">${perc.toFixed(2)}%</b>`;
  } else {
    document.getElementById('percUtilResult'+id).textContent='';
  }
}

function calcularParray(id){
  const potModulo = num(document.getElementById('moduloPot'+id)?.value, 0);
  const numModulos = num(document.getElementById('numModulos'+id)?.value, 0);
  if(potModulo > 0 && numModulos > 0){
    const kWp = (potModulo * numModulos) / 1000;
    document.getElementById('kWp'+id).value = kWp.toFixed(2);
    document.getElementById('parrayResult'+id).textContent = `Pot√™ncia do array: ${kWp.toFixed(2)} kWp`;
  }else{
    document.getElementById('parrayResult'+id).textContent = '';
  }
}

let carros = [{id:0}];
let placas = [{id:0}];
let nextCarroId = 1;
let nextPlacaId = 1;

function renderCarros(){
  const container = document.getElementById('carrosContainer');
  container.innerHTML = carros.map(c=>carroFields(c.id, c)).join('');
  updateSavedCarModels();
}
function renderPlacas(){
  const container = document.getElementById('placasContainer');
  container.innerHTML = placas.map(p=>placaFields(p.id, p)).join('');
  updateSavedPlacaModels();
}
function adicionarCarro(){
  carros.push({id:nextCarroId++});
  renderCarros();
}
function removerCarro(id){
  carros = carros.filter(c=>c.id!==id);
  if(carros.length===0){carros=[{id:nextCarroId++}];}
  renderCarros();
}
function adicionarPlaca(){
  placas.push({id:nextPlacaId++});
  renderPlacas();
}
function removerPlaca(id){
  placas = placas.filter(p=>p.id!==id);
  if(placas.length===0){placas=[{id:nextPlacaId++}];}
  renderPlacas();
}

// Salvar/Carregar configura√ß√µes
function getConfigFromFields(){
  // Carros
  let carrosData = carros.map(c=>({
    id: c.id,
    nome: document.getElementById('carroNome'+c.id)?.value||'',
    capNominal: num(document.getElementById('capNominal'+c.id)?.value, 60),
    percUtil: num(document.getElementById('percUtil'+c.id)?.value, 95),
    socIni: num(document.getElementById('socIni'+c.id)?.value, 20),
    socFim: num(document.getElementById('socFim'+c.id)?.value, 100),
    etaGlobal: num(document.getElementById('etaGlobal'+c.id)?.value, 85),
    onboardKW: num(document.getElementById('onboardKW'+c.id)?.value, 7.4)
  }));
  // Placas
  let placasData = placas.map(p=>({
    id: p.id,
    nome: document.getElementById('placaNome'+p.id)?.value||'',
    kWp: num(document.getElementById('kWp'+p.id)?.value, 2.0),
    pr: num(document.getElementById('pr'+p.id)?.value, 75),
    psh: num(document.getElementById('psh'+p.id)?.value, 5),
    obs: document.getElementById('obs'+p.id)?.value||''
  }));
  return {carros:carrosData, placas:placasData};
}

function saveConfig(){
  const input = document.getElementById('configNameInput');
  const nome = input?.value?.trim() || prompt('Nome para salvar configura√ß√£o:');
  if(!nome) return;
  let configs = JSON.parse(localStorage.getItem('evConfigs')||'{}');
  configs[nome] = getConfigFromFields();
  localStorage.setItem('evConfigs', JSON.stringify(configs));
  updateSavedConfigs();
  alert('Configura√ß√£o salva!');
}
function updateSavedConfigs(){
  let configs = JSON.parse(localStorage.getItem('evConfigs')||'{}');
  const select = document.getElementById('savedConfigs');
  select.innerHTML = Object.keys(configs).map(n=>`<option value="${n}">${n}</option>`).join('');
  const badge = document.getElementById('countConfigs');
  if(badge) badge.textContent = Object.keys(configs).length;
}
function loadConfig(){
  const select = document.getElementById('savedConfigs');
  const nome = select.value;
  if(!nome) return;
  let configs = JSON.parse(localStorage.getItem('evConfigs')||'{}');
  const conf = configs[nome];
  if(!conf) return;
  carros = conf.carros.map((c,i)=>({...c,id:i}));
  placas = conf.placas.map((p,i)=>({...p,id:i}));
  nextCarroId = carros.length;
  nextPlacaId = placas.length;
  renderCarros();
  renderPlacas();
  updateSavedCarModels();
  updateSavedPlacaModels();
}
function deleteConfig(){
  const select = document.getElementById('savedConfigs');
  const nome = select.value;
  if(!nome) return;
  let configs = JSON.parse(localStorage.getItem('evConfigs')||'{}');
  delete configs[nome];
  localStorage.setItem('evConfigs', JSON.stringify(configs));
  updateSavedConfigs();
}

// Salvar/Carregar modelos de carro
function getCarModelFromFields(id){
  return {
    nome: document.getElementById('carroNome'+id)?.value||'',
    capNominal: num(document.getElementById('capNominal'+id)?.value, 60),
    percUtil: num(document.getElementById('percUtil'+id)?.value, 95),
    socIni: num(document.getElementById('socIni'+id)?.value, 20),
    socFim: num(document.getElementById('socFim'+id)?.value, 100),
    etaGlobal: num(document.getElementById('etaGlobal'+id)?.value, 85),
    onboardKW: num(document.getElementById('onboardKW'+id)?.value, 7.4)
  };
}
function saveCarModel(){
  if(carros.length===0) return;
  const targetSelect = document.getElementById('carSelect');
  const id = Number(targetSelect?.value ?? carros[0].id);
  const nomeInput = document.getElementById('carModelNameInput');
  const nome = nomeInput?.value?.trim();
  if(!nome){ alert('Defina um nome para o modelo de carro.'); return; }
  let models = JSON.parse(localStorage.getItem('carModels')||'{}');
  models[nome] = getCarModelFromFields(id);
  localStorage.setItem('carModels', JSON.stringify(models));
  updateSavedCarModels();
  alert('Modelo de carro salvo!');
}
function updateSavedCarModels(){
  let models = JSON.parse(localStorage.getItem('carModels')||'{}');
  const savedSel = document.getElementById('savedCarModels');
  if(savedSel) savedSel.innerHTML = Object.keys(models).map(n=>`<option value="${n}">${n}</option>`).join('');
  const badge = document.getElementById('countCarModels');
  if(badge) badge.textContent = Object.keys(models).length;
  // Atualiza selects de carros
  const carSelect = document.getElementById('carSelect');
  const carSelectApply = document.getElementById('carSelectApply');
  const options = carros.map(c=>`<option value="${c.id}">${document.getElementById('carroNome'+c.id)?.value||'Carro '+(c.id+1)}</option>`).join('');
  if(carSelect) carSelect.innerHTML = options;
  if(carSelectApply) carSelectApply.innerHTML = options;
}
function loadCarModel(){
  const savedSel = document.getElementById('savedCarModels');
  const applySel = document.getElementById('carSelectApply');
  if(!savedSel || !applySel) return;
  const nome = savedSel.value;
  const carId = Number(applySel.value);
  if(!nome || isNaN(carId)) return;
  let models = JSON.parse(localStorage.getItem('carModels')||'{}');
  const model = models[nome];
  if(!model) return;
  document.getElementById('carroNome'+carId).value = model.nome;
  document.getElementById('capNominal'+carId).value = model.capNominal;
  document.getElementById('percUtil'+carId).value = model.percUtil;
  document.getElementById('socIni'+carId).value = model.socIni;
  document.getElementById('socFim'+carId).value = model.socFim;
  document.getElementById('etaGlobal'+carId).value = model.etaGlobal;
  document.getElementById('onboardKW'+carId).value = model.onboardKW;
  alert('Modelo aplicado!');
}

// Salvar/Carregar modelos de placa
function getPlacaModelFromFields(id){
  return {
    nome: document.getElementById('placaNome'+id)?.value||'',
    kWp: num(document.getElementById('kWp'+id)?.value, 2.0),
    pr: num(document.getElementById('pr'+id)?.value, 75),
    psh: num(document.getElementById('psh'+id)?.value, 5),
    obs: document.getElementById('obs'+id)?.value||''
  };
}
function savePlacaModel(){
  if(placas.length===0) return;
  const targetSelect = document.getElementById('placaSelect');
  const id = Number(targetSelect?.value ?? placas[0].id);
  const nomeInput = document.getElementById('placaModelNameInput');
  const nome = nomeInput?.value?.trim();
  if(!nome){ alert('Defina um nome para o modelo de placa.'); return; }
  let models = JSON.parse(localStorage.getItem('placaModels')||'{}');
  models[nome] = getPlacaModelFromFields(id);
  localStorage.setItem('placaModels', JSON.stringify(models));
  updateSavedPlacaModels();
  alert('Modelo de placa salvo!');
}
function updateSavedPlacaModels(){
  let models = JSON.parse(localStorage.getItem('placaModels')||'{}');
  const savedSel = document.getElementById('savedPlacaModels');
  if(savedSel) savedSel.innerHTML = Object.keys(models).map(n=>`<option value="${n}">${n}</option>`).join('');
  const badge = document.getElementById('countPlacaModels');
  if(badge) badge.textContent = Object.keys(models).length;
  const placaSelect = document.getElementById('placaSelect');
  const placaSelectApply = document.getElementById('placaSelectApply');
  const options = placas.map(p=>`<option value="${p.id}">${document.getElementById('placaNome'+p.id)?.value||'Placa '+(p.id+1)}</option>`).join('');
  if(placaSelect) placaSelect.innerHTML = options;
  if(placaSelectApply) placaSelectApply.innerHTML = options;
}
function loadPlacaModel(){
  const savedSel = document.getElementById('savedPlacaModels');
  const applySel = document.getElementById('placaSelectApply');
  if(!savedSel || !applySel) return;
  const nome = savedSel.value;
  const placaId = Number(applySel.value);
  if(!nome || isNaN(placaId)) return;
  let models = JSON.parse(localStorage.getItem('placaModels')||'{}');
  const model = models[nome];
  if(!model) return;
  document.getElementById('placaNome'+placaId).value = model.nome;
  document.getElementById('kWp'+placaId).value = model.kWp;
  document.getElementById('pr'+placaId).value = model.pr;
  document.getElementById('psh'+placaId).value = model.psh;
  document.getElementById('obs'+placaId).value = model.obs;
  alert('Modelo aplicado!');
}

// C√°lculo para m√∫ltiplos carros/placas (ainda exibe s√≥ do primeiro)

function calcular(){
  // Somar energia de todos os carros
  let E_bat_total = 0;
  let E_pv_total = 0;
  let onboardKW_total = 0;
  let etaGlobal_min = 1;
  let alerts = [];
  let nomesCarros = [];
  carros.forEach(c => {
    const capNominal = num(document.getElementById('capNominal'+c.id)?.value, 60);
    const percUtil   = clamp(num(document.getElementById('percUtil'+c.id)?.value, 95), 0, 100) / 100.0;
    const socIni     = clamp(num(document.getElementById('socIni'+c.id)?.value, 20), 0, 100) / 100.0;
    const socFim     = clamp(num(document.getElementById('socFim'+c.id)?.value, 100), 0, 100) / 100.0;
    const etaGlobal  = clamp(num(document.getElementById('etaGlobal'+c.id)?.value, 85), 1, 100) / 100.0;
    const onboardKW  = Math.max(0, num(document.getElementById('onboardKW'+c.id)?.value, 7.4));
    nomesCarros.push(document.getElementById('carroNome'+c.id)?.value||'Carro '+(c.id+1));
    if (socFim <= socIni) alerts.push(`O SOC final do carro ${nomesCarros[nomesCarros.length-1]} deve ser maior que o SOC inicial.`);
    const capUtil_kWh = capNominal * percUtil;
    const deltaSOC    = Math.max(0, socFim - socIni);
    const E_bat       = capUtil_kWh * deltaSOC;
    const E_pv        = E_bat > 0 ? E_bat / etaGlobal : 0;
    E_bat_total += E_bat;
    E_pv_total += E_pv;
    onboardKW_total += onboardKW;
    if (etaGlobal < etaGlobal_min) etaGlobal_min = etaGlobal;
    if (etaGlobal < 0.75) alerts.push(`Efici√™ncia global baixa no carro ${nomesCarros[nomesCarros.length-1]}`);
  });

  // Somar pot√™ncia e gera√ß√£o das placas
  let kWp_total = 0;
  let pr_total = 0;
  let psh_total = 0;
  let nomesPlacas = [];
  placas.forEach(p => {
    const kWp = Math.max(0, num(document.getElementById('kWp'+p.id)?.value, 2.0));
    const pr  = clamp(num(document.getElementById('pr'+p.id)?.value, 75), 1, 100) / 100.0;
    const psh = Math.max(0, num(document.getElementById('psh'+p.id)?.value, 5));
    nomesPlacas.push(document.getElementById('placaNome'+p.id)?.value||'Placa '+(p.id+1));
    if (kWp <= 0) alerts.push(`Defina a pot√™ncia do array (kWp) > 0 para ${nomesPlacas[nomesPlacas.length-1]}.`);
    if (psh <= 0) alerts.push(`Defina as horas de sol pleno (PSH) > 0 para ${nomesPlacas[nomesPlacas.length-1]}.`);
    kWp_total += kWp;
    pr_total += pr;
    psh_total += psh;
  });
  // M√©dia dos PR e PSH
  pr_total = placas.length ? pr_total/placas.length : 0;
  psh_total = placas.length ? psh_total/placas.length : 0;

  // C√°lculos totais
  const E_dia = kWp_total * psh_total * pr_total;
  const dias = (E_dia > 0) ? (E_pv_total / E_dia) : Infinity;
  const horasSol = (kWp_total*pr_total > 0) ? (E_pv_total / (kWp_total * pr_total)) : Infinity;
  const P_pico_FV = kWp_total * pr_total;
  const P_lim = Math.max(0, Math.min(onboardKW_total || Infinity, P_pico_FV || Infinity));
  const t_min = (P_lim > 0) ? (E_bat_total / P_lim) : Infinity;

  if (P_pico_FV < 1.0) alerts.push("Pot√™ncia de pico FV baixa; carregamento ser√° bem lento.");
  if (!Number.isFinite(dias) || !Number.isFinite(horasSol)) alerts.push("Verifique os campos: h√° valores inv√°lidos.");

  // Exibir KPIs totais
  document.getElementById('kpiEbat').innerHTML  = `<span class="ok">${fmtKWh(E_bat_total)}</span>`;
  document.getElementById('kpiEpv').innerHTML   = fmtKWh(E_pv_total);
  document.getElementById('kpiEdia').innerHTML  = fmtKWh(E_dia) + ` <small>(por dia)</small>`;
  document.getElementById('kpiDias').innerHTML  = fmtDias(dias);
  document.getElementById('kpiHoras').innerHTML = fmtH(horasSol);
  document.getElementById('kpiTmin').innerHTML  = Number.isFinite(t_min) ? fmtH(t_min) : '‚Äî';

  const alertBox = document.getElementById('alerts');
  const alertText = document.getElementById('alertText');
  if (alerts.length){
    alertBox.style.display = 'block';
    alertText.innerHTML = '‚ö†Ô∏è ' + alerts.join('<br>');
  }else{
    alertBox.style.display = 'none';
    alertText.innerHTML = '';
  }
}

function limpar(){
  carros = [{id:0}];
  placas = [{id:0}];
  nextCarroId = 1;
  nextPlacaId = 1;
  renderCarros();
  renderPlacas();
  // limpa resultados
  ['kpiEbat','kpiEpv','kpiEdia','kpiDias','kpiHoras','kpiTmin'].forEach(id=>{
    document.getElementById(id).textContent = '‚Äî';
  });
  document.getElementById('alerts').style.display = 'none';
  document.getElementById('alertText').textContent = '';
}

// Eventos
document.getElementById('calcBtn').addEventListener('click', calcular);
document.getElementById('resetBtn').addEventListener('click', limpar);
document.getElementById('saveConfigModalBtn').addEventListener('click', saveConfig);
document.getElementById('loadConfigBtn').addEventListener('click', loadConfig);
document.getElementById('deleteConfigBtn').addEventListener('click', deleteConfig);
document.getElementById('saveCarModelBtn').addEventListener('click', saveCarModel);
document.getElementById('loadCarModelBtn').addEventListener('click', loadCarModel);
document.getElementById('savePlacaModelBtn').addEventListener('click', savePlacaModel);
document.getElementById('loadPlacaModelBtn').addEventListener('click', loadPlacaModel);

// Inicializa√ß√£o
renderCarros(); // j√° cria Carro 1
renderPlacas(); // j√° cria Placa 1
updateSavedConfigs();
updateSavedCarModels();
updateSavedPlacaModels();
initSaveModal();
calcular();
</script>
</body>
</html>
